# Rust風言語パーサー・インタープリター

このプロジェクトは、Rust風の言語構文を解析・実行するパーサーとインタープリターの実装です。Larkライブラリを使用してパーサーを構築し、カスタムAST（抽象構文木）を使用してコードを実行します。

## プロジェクト構成

### 主要ファイル

- `main.py` - メインエントリーポイント。パーサーの実行とエラーハンドリング
- `calc_grammar.lark` - Rust風言語の文法定義ファイル（Lark構文）
- `calc_transformer.py` - LarkのTreeからカスタムNodeへの変換処理
- `interpreter.py` - ASTを実行するインタープリター（型システム、変数管理、関数実行）
- `node.py` - AST（抽象構文木）のNode実装
- `memory.py` - メモリ管理システム
- `eval.py` - 型検査システム
- `test.rs` - サンプルRustコード（テスト用）

### サポート言語

- **データ型**: `i32`, `f64`, `bool`, `String`, `char`, `()`（unit型）、配列型
- **構文**: 関数定義、変数宣言（let）、条件分岐（if/else）、ループ（while、loop）、パターンマッチング（match）
- **演算子**: 四則演算、比較演算、論理演算
- **関数**: 関数定義、関数呼び出し、引数、戻り値

### 文法定義のハイライト

```lark
function : "fn" _ws identifier _ws "(" param_list? ")" ( _ws "->" _ws annotated_type )? _ws "{" statement* "}" 
let : _ws "let" _ws identifier _ws (":" _ws annotated_type)? _ws "=" _ws expr _ws ";" _ws
```

## 現在の開発状況

### 実装済み機能

- ✅ 基本的な文法解析（関数、変数、式）
- ✅ 型アノテーション（i32, f64, bool, String, char, unit, 配列）
- ✅ 四則演算の優先順位処理
- ✅ 変数スコープ管理（関数ごと）
- ✅ 関数定義と呼び出し
- ✅ コメント処理（行コメント`//`、複数行コメント`/* */`）
- ✅ エラー位置の詳細表示

### 部分的実装

- ⚠️ 型検査システム（現在無効化されている - main.py:64）
- ⚠️ 制御構文（if, while, loop, match）- パース可能だが実行時処理が不完全
- ⚠️ 関数引数の処理（パース可能だが実行時エラーあり - interpreter.py:256）

### 未実装・課題

- ❌ 配列の実装と操作
- ❌ パターンマッチングの完全な実装
- ❌ エラーハンドリングの改善
- ❌ 標準ライブラリ関数
- ❌ モジュールシステム

## 実行方法

```bash
python3 main.py
```

現在は`test.rs`ファイルを読み込んで実行します。サンプルコードには関数定義と四則演算が含まれています。

## 開発中の問題

1. **型検査システム**: 現在無効化されており、型安全性が保証されていない
2. **関数引数**: 引数を持つ関数の呼び出しでスタック操作エラーが発生
3. **制御構文**: if/while/loop/matchの実行ロジックが不完全
4. **メモリ管理**: 変数スコープの管理に一部不整合がある

## 技術スタック

- **Python 3.x**
- **Lark** - パーサージェネレーター
- **カスタムAST** - Node クラスベースの抽象構文木

このプロジェクトは教育目的や言語実装の学習に適しており、段階的にRust風言語の機能を拡張していくことが可能です。